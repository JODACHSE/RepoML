""" Machine learning - Linear Regression"""
from sklearn.linear_model import LinearRegression
import pandas as pd
import matplotlib.pyplot as plt
import io
import base64
from flask import Flask
import matplotlib
matplotlib.use('Agg')  # Para evitar que pylot se vaya en hilos secundarios

app = Flask(__name__)
# Datos de ejemplo
data = {
    "Altura (cm)": [
        20.99835447, 92.8829578, 84.87123942, 47.387838, 66.62399205, 28.42168899, 78.67470081, 62.05629602, 47.44495645, 87.67539134,
        96.58229446, 22.69031714, 82.06831727, 90.2958879, 91.15893024, 60.1232885, 40.8017561, 74.73331446, 15.9471511, 69.29043949,
        55.14557335, 85.69927554, 13.62396556, 13.86716528, 54.56357499, 98.6665377, 98.25767273, 88.19933132, 13.31596371, 64.57865679,
        52.73275254, 70.39394933, 71.60523166, 95.59786342, 53.95997255, 50.18842884, 31.75482327, 99.17517815, 30.99954075, 16.29403141,
        93.62323701, 36.1520996, 45.81173743, 43.53267978, 59.58998219, 94.0409332, 72.44380772, 35.34413456, 15.89971896, 83.98415121,
        10.47661585, 81.00197348, 46.46938836, 91.82125664, 57.93776935, 97.62647741, 35.98597447, 22.98726631, 90.97923912, 33.12478051,
        52.47331679, 20.61339973, 34.22970003, 73.60985308, 87.35068671, 31.3998038, 80.90497886, 78.86610392, 73.67666189, 63.81462416,
        34.81310592, 46.36760187, 73.7758219, 13.33042358, 76.0330758, 59.94222714, 88.36921235, 48.49580858, 62.0848989, 45.18570725,
        97.66986546, 15.78282464, 16.52576605, 43.19498642, 85.12178617, 99.77710326, 92.34649757, 93.79156518, 52.86712687, 92.49008001,
        79.60907658, 16.95543046, 87.77402293, 78.4574323, 54.54491606, 71.10931645, 43.53169086, 55.1778064, 27.43534104, 33.67914617,
        74.60895452, 38.39542524, 22.66098485, 22.26242222, 33.68440521, 49.02160073, 51.21657435, 54.91599193, 94.39029605, 91.46398562,
        84.89957707, 40.51522414, 41.7857447, 68.90822596, 51.13320577, 19.92349451, 62.95553434, 99.26079306, 37.73614765, 48.60273726,
        26.20637019, 49.67150443, 62.6576239, 70.41801596, 98.31037621, 52.75086125, 65.86239243, 10.69736349, 80.64604268, 43.04464184,
        93.6455376, 76.51235321, 48.12453077, 83.94826767, 48.01749661, 99.26881721, 34.75132969, 62.85326966, 46.36725012, 54.31537835,
        90.70556517, 92.79032489, 46.57867427, 64.21768863, 88.72391954, 71.8412306, 48.39911446, 66.47604365, 12.74683516, 29.69095779,
        54.66140232, 38.61132613, 79.83153551, 74.27561248, 86.81530338, 18.59426601, 68.92856079, 98.45797466, 51.4298328, 42.33070494,
        34.74804616, 50.86169902, 93.66456404, 65.588448, 63.80042991, 11.18050024, 91.49722345, 99.26251126, 66.63796138, 72.41270358,
        63.86225883, 81.3938563, 56.53534013, 37.65832742, 87.05122179, 99.70737244, 57.58754618, 59.32965761, 62.12984982, 50.55767598,
        11.05050428, 92.19294594, 30.56724828, 59.25329955, 67.35521728, 55.57480795, 23.06330677, 86.36799367, 51.5976879, 10.81072044,
        80.52874241, 51.91310203, 42.27253545, 21.64419603, 73.89766705, 32.47757439, 28.31342018, 25.54102034, 64.5921867, 62.83500906,
        33.11450034, 14.77132546, 43.19430957, 48.23908962, 97.91023861, 40.91214799, 39.88777629, 10.33799759, 46.97370897, 68.2964975,
        27.31196068, 37.92380082, 64.57453108, 36.78486827, 59.9641286, 61.22110855, 33.63563502, 52.67252653, 85.94997273, 52.88176396,
        60.65917312, 31.46943458, 34.75350649, 48.57410054, 65.99394179, 36.26808809, 61.36209009, 42.53954934, 29.95388771, 12.91386361,
        81.719723, 28.27011439, 21.78441161, 35.07716468, 67.19830567, 66.1475894, 78.24250645, 57.61943916, 20.16031097, 69.50090428,
        85.9682043, 52.95778735, 19.97296059, 66.31490172, 96.44826033, 72.03106096, 13.9821815, 12.21556224, 73.54486512, 28.98124978,
        80.34799839, 79.51875067, 13.79609749, 34.343321, 71.65278418, 11.48083753, 98.84672677, 71.37679143, 33.33420287, 24.23575928,
        38.11789532, 88.35188968, 49.64091222, 31.21997449, 26.29810106, 64.49522923, 26.2408853, 12.6860315, 27.60912949, 66.80336048,
        28.15175717, 92.58725882, 75.34059952, 72.76146206, 44.25489949, 29.11526291, 56.96846785, 69.85769583, 53.2826145, 40.68928659,
        81.73839167, 64.70830233, 40.12281382, 34.87528049, 96.13811503, 47.90136926, 37.84925606, 53.77400772, 39.32641484, 37.50042979,
        24.42629396, 67.98047412, 37.60125302, 76.81103436, 48.59703892, 31.85677863, 63.3282063, 49.29077263, 51.60564226, 66.45791739,
        54.66554467, 32.0035855, 37.62499346, 59.98945188, 82.92788531, 53.55250472, 78.83858518, 61.90495489, 87.86464151, 89.50127039,
        26.35706322, 77.78323965, 47.74406957, 51.92764828, 85.96662385, 72.7779112, 97.03447119, 42.91550694, 30.63151226, 71.83813626,
        47.81926059, 23.66660217, 82.55516414, 17.77867911, 56.85362083, 77.82097168, 30.42888654, 12.49528646, 33.39269422, 78.04415631,
        97.08800589, 44.92068239, 67.24740826, 64.62509282, 31.50761408, 95.74192238, 73.67755749, 81.64734287, 53.53134962, 10.78175614,
        97.53292661, 11.73175719, 58.97250032, 81.28560518, 50.84735297, 92.88474748, 70.73338098, 46.68760913, 56.02182449, 22.41626581,
        32.3558459, 84.59011224, 64.4295705, 12.59752361, 33.20844702, 97.27735168, 94.42315622, 18.72066418, 37.24860803, 39.93117139,
        14.08215351, 57.06104805, 60.02219239, 41.43321622, 38.66135603, 81.86567413, 50.27094673, 12.55803825, 90.33961998, 98.28906163,
        73.70277506, 49.17602911, 89.78768436, 90.36338899, 36.83110057, 69.53064566, 65.24337121, 64.6048486, 88.76234174, 34.332274,
        69.08165053, 84.65596346, 15.10719691, 66.56537768, 20.91498403, 45.70626413, 66.86961182, 65.47480417, 75.47960105, 93.54891516,
        55.22907606, 69.77482401, 63.7782049, 36.46973249, 62.63965294, 20.066499, 16.65604564, 43.94627934, 47.98323762, 58.53122791,
        11.1929712, 44.29612401, 54.35589222, 16.92689406, 58.06354763, 27.05779338, 78.93364073, 25.83770601, 26.38862806, 84.85328363,
        21.10452491, 78.42307091, 54.24453746, 13.36316354, 95.57439536, 69.44325493, 23.5357999, 86.14830707, 77.2428732, 39.24475632,
        10.26452277, 12.9084587, 36.11510757, 89.96536272, 37.44009596, 32.76994809, 49.39613191, 75.01676214, 28.82300657, 75.64671446,
        79.01818521, 31.61853151, 43.17766919, 63.64624176, 87.32121895, 44.14486474, 11.76501528, 43.4027266, 21.08861001, 81.44971272,
        37.10226178, 29.14801969, 70.11399954, 96.60586894, 31.97804675, 73.80569817, 27.74109996, 45.430744, 74.14630036, 58.58476724,
        14.2588121, 40.3319596, 80.72371427, 81.87228466, 32.01890951, 29.07577629, 14.61590889, 76.07744348, 69.99949233, 60.71924886,
        75.62516128, 47.32577104, 69.49161849, 39.7916992, 36.6443527, 87.90331009, 23.60507389, 31.42851903, 34.78774112, 72.58930005,
        55.66784036, 47.75411783, 10.54350284, 34.81696364, 24.69902652, 91.18766545, 38.93880078, 90.01017377, 56.29258393, 52.14568455,
        72.55149769, 20.4564025, 16.84338287, 25.56254195, 95.52968056, 39.24757564, 69.05675772, 95.74795513, 38.40771568, 81.78077303,
        50.93958584, 61.75177671, 71.78005814, 71.30364976, 25.70407152, 68.45206825, 75.74385458, 73.21819706, 87.96647658, 96.70335245
    ],

    "Peso (kg)": [
        222.1696391, 863.1420725, 784.6182442, 449.5939844, 624.0777226, 283.745651, 731.9327824, 577.6950679, 453.778969, 813.8904752,
        891.0938201, 215.8083756, 760.9382527, 833.8272821, 856.3303884, 568.5125402, 392.5804967, 703.5283819, 178.7425238, 645.1189673,
        520.9841694, 800.8011161, 140.7344582, 150.2459407, 516.406166, 903.8008207, 910.98314, 819.7966099, 143.6583153, 597.4573713,
        500.6602133, 658.0364635, 670.5333377, 881.2006948, 519.2841707, 480.039552, 312.7190845, 917.1273884, 305.2425308, 181.1990297,
        868.9047832, 348.4399788, 441.4831761, 414.6846696, 557.949938, 875.6711665, 666.4283871, 334.4304653, 162.9861197, 772.5206601,
        116.8136134, 754.4433435, 439.9455518, 842.8973403, 552.4975532, 907.8518707, 347.9495449, 233.6050884, 851.8118631, 317.1636234,
        496.9120618, 207.4933922, 329.7772882, 688.3193967, 816.3571128, 306.5489607, 752.3783187, 730.6256268, 686.3190038, 597.0620527,
        339.0409074, 440.3926951, 690.4310747, 139.0900202, 709.577697, 557.1819263, 816.1012758, 464.02279, 577.0868459, 432.8703492,
        904.6017703, 162.2814864, 176.5886301, 404.1306999, 798.4938963, 920.3064897, 862.3172782, 865.6482147, 496.5658439, 857.7355878,
        738.5559244, 181.7533093, 820.5586311, 735.1672833, 513.0278727, 662.7858639, 414.9511991, 527.8931681, 266.0356036, 329.2881443,
        688.440706, 366.0022651, 231.6429476, 220.7039901, 331.5033649, 466.1174193, 478.8544766, 531.8893703, 876.3511985, 848.4362618,
        782.7199286, 388.6700389, 404.2584113, 650.9734067, 493.231855, 204.6916307, 589.1262781, 916.9647299, 367.2210221, 464.7869783,
        259.5686221, 467.1457095, 587.7423781, 666.9491564, 906.1714942, 505.7235292, 622.6146701, 113.6381503, 751.5594489, 409.6367004,
        866.2071707, 717.2704015, 456.1523046, 785.9707679, 461.0659083, 918.5977861, 346.0128416, 587.7512456, 441.7691267, 511.3704708,
        838.8711454, 860.2653049, 444.2998099, 600.0781578, 822.1292036, 674.9937937, 461.3662637, 623.5561366, 136.799503, 296.350545,
        522.6707835, 382.0861278, 747.8471272, 698.6879616, 800.2767544, 199.5565619, 638.954044, 907.9792964, 486.6382836, 411.2594349,
        337.971397, 482.2574825, 861.998942, 620.6815721, 598.5883595, 120.6982236, 851.3895063, 919.2103254, 627.7913787, 671.4267572,
        604.8771864, 760.2206031, 535.1193136, 365.5138442, 801.0940284, 919.9562963, 543.2906742, 567.6249885, 586.6792995, 475.1729481,
        127.4893971, 853.6679583, 298.9120209, 552.8001277, 624.5938463, 522.8824518, 230.1801195, 802.5126563, 490.4059868, 122.4944017,
        753.7280423, 493.2847371, 398.7757916, 222.158451, 684.3759843, 313.9097813, 283.5821215, 249.5711001, 604.6500851, 580.5932359,
        317.7092467, 154.9366896, 414.4656912, 456.9066685, 907.2762103, 389.3389511, 391.2933329, 112.1703416, 449.7389943, 634.6262287,
        266.3572299, 366.5600171, 601.3159345, 356.688757, 558.0031396, 574.5746723, 320.0011993, 500.5601329, 800.2955148, 496.3117826,
        571.6501756, 301.3762424, 331.18098, 467.0050939, 624.5549131, 351.8118419, 577.261534, 402.0645149, 292.0540258, 135.8102642,
        760.0784668, 287.9846638, 221.2978757, 339.9793739, 628.5552988, 613.9754335, 730.8713867, 551.2658029, 212.7604638, 639.3476025,
        802.172477, 498.723701, 202.2269113, 625.7118954, 894.0046069, 669.5887643, 151.9652853, 137.3492662, 685.2938154, 274.7922231,
        750.9440349, 739.2767883, 150.1048087, 337.0043813, 669.857331, 116.7249904, 913.9276097, 679.5342821, 326.8688133, 243.1004027,
        354.9350321, 819.5062903, 474.5247115, 307.8929078, 262.122122, 614.3850062, 256.725708, 143.840733, 271.3497738, 630.5764136,
        277.7078414, 855.7491196, 702.4548535, 679.4092327, 424.8975207, 287.3540352, 542.2373489, 653.619303, 513.8750103, 395.9621409,
        758.5791541, 606.5134568, 384.4158799, 343.854274, 893.2334681, 471.6180075, 358.8963054, 496.9649836, 372.0481546, 362.9902434,
        245.654137, 639.2019231, 362.7680685, 711.9593563, 466.8960419, 309.4719248, 600.5478591, 461.5423753, 484.711672, 625.43316,
        527.3617884, 306.3054712, 359.3290314, 559.9901047, 775.4821084, 515.9534457, 738.7997577, 584.2933479, 815.5003604, 829.0764082,
        264.0797626, 724.3128318, 461.3601859, 491.801651, 791.4782639, 673.8412134, 889.9298442, 413.4841669, 293.7046326, 671.4599682,
        443.6969405, 242.9856382, 770.8245203, 181.3635287, 534.6306259, 726.6885422, 293.8542813, 131.8538272, 322.25043, 722.5007664,
        890.2408509, 430.1835761, 633.8090856, 610.8841971, 297.8094161, 890.7387023, 691.4885445, 765.9506711, 502.0255372, 112.164525,
        897.1224524, 132.0322169, 551.5684636, 753.4800093, 486.6337285, 866.4220744, 660.0186204, 455.4803711, 527.5992794, 226.8554399,
        311.6029928, 787.5829998, 610.2165097, 139.429001, 339.3441893, 905.2483755, 871.5060712, 190.4748058, 357.9101691, 382.1476281,
        153.1498592, 536.3716885, 567.8316118, 397.2574644, 369.6345681, 755.1464198, 477.9625666, 136.5950382, 838.5004559, 910.1040684,
        700.862507, 468.9546026, 838.4237305, 841.3134915, 355.8256622, 645.2687655, 612.670886, 609.1893681, 822.2416624, 333.8666842,
        646.8300248, 793.1337398, 157.2416549, 613.0221213, 215.0284052, 435.4430792, 632.8674842, 614.3588454, 703.1609051, 867.5829885,
        520.3373532, 641.6570815, 611.2032254, 354.991182, 588.918959, 204.9626004, 168.0502257, 414.7346984, 461.0110801, 544.0518266,
        129.8139246, 422.2152511, 506.2056229, 172.2898559, 543.963557, 264.4812878, 743.5589223, 259.1477658, 257.9052223, 788.6460089,
        216.2610631, 720.3334358, 513.2211168, 140.1262659, 885.9722944, 647.7306042, 230.3287274, 805.3890247, 717.7648723, 365.7039536,
        113.7460456, 138.3236002, 364.4979671, 837.6296228, 355.9932629, 317.6320091, 464.4726874, 696.1243602, 282.8351318, 709.17809,
        739.1148773, 314.8576424, 407.3720848, 596.7138648, 815.7449823, 419.7375521, 130.618226, 421.6368112, 209.6963369, 753.1759922,
        352.7602394, 279.5988319, 660.4073631, 901.9875216, 314.992486, 684.1750957, 271.602019, 425.3028809, 697.3862789, 551.4000378,
        148.1959171, 388.2419091, 754.9007929, 759.2672537, 306.3385098, 283.2559959, 154.6131828, 706.2908788, 661.7100154, 578.2628692,
        709.9784403, 452.0347072, 644.4821075, 378.9505046, 358.3441682, 811.9839171, 236.7344949, 311.5415018, 331.1308945, 665.1677955,
        525.091265, 450.5829112, 123.519086, 339.3252275, 250.2125072, 852.6254822, 379.6650012, 841.2721712, 533.0136206, 499.324338,
        687.3205374, 209.5597418, 169.2123788, 246.2208318, 882.970519, 381.3943971, 648.144614, 890.0551228, 369.9499841, 755.9661572,
        481.4059002, 574.1893457, 674.0865984, 665.9725217, 258.3253187, 632.8488555, 691.299664, 689.7907926, 812.7657601, 888.359984
    ]
}
df = pd.DataFrame(data)

X = df[["Altura (cm)"]]
y = df["Peso (kg)"]
model = LinearRegression()
model.fit(X, y)


def generate_graph():
    """
    Generar un grafico de dispersion con la linea de regresion y el punto del dato del usuario
    """
    plt.figure(figsize=(8, 5))
    plt.scatter(df["Altura (cm)"], df["Peso (kg)"],
                color='blue', label="Datos reales")
    plt.plot(df["Altura (cm)"], model.predict(X), color='red',
             linewidth=2, label="Línea de regresión")
    plt.xlabel("Altura (cm)")
    plt.ylabel("Peso (kg)")
    plt.title("Regresión Lineal: Altura vs Peso")
    plt.legend()
    plt.grid(True)

    buffer = io.BytesIO()
    plt.savefig(buffer, format="png")
    buffer.seek(0)
    image_base64 = base64.b64encode(buffer.getvalue()).decode("utf-8")
    plt.close()
    return image_base64


if __name__ == '__main__':
    app.run(debug=True)
